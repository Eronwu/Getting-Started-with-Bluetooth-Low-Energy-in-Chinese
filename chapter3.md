# 第三章节，GAP(广播和连接，Advertising and Connections)

通用访问配置文件（GAP）是BLE设备间相互操作的基础。GAP提供了一个任意一个BLE实现需要遵循的框架，都必须发现各自设备、广播数据、建立安全连接和在一个标准、普遍熟知的方式下执行完成一些其他的基础操作。彻底地了解GAP是非常重要的，因为当提供一个功能性API给应用开发者时，许多BLE协议栈都将其用作最底层入口之一。

就如之前所提到的，BLE核心规格书中GAP章节的部分定义了以下几个设备交互的不同方面：

*角色（Roles）*

​		每一个设备都可以同时操作一个或多个角色。每一个角色都有限制条件并且强制一定的行为要求。一些角色的结合体允许设备相互交流，GAP则在这些角色间精确地建立了交互。虽然并不总是这样，角色倾向于关联特定的设备类型，而且对于大多数（虽然不是全部）实现，角色也会在他们的使用场景下紧密绑定而不作任何改变。

*模式（Modes）*

​		这是更进一步优化角色的概念，模式是设备为了一定量时间获取一个特定的目标的转化的状态，或者更具体来说，允许一端完成一个特定的流程。转换状态可以由用户接口操作或者当被需要时自动地触发，设备比角色更频繁尝试转换角色。

*流程（Procedure）*

​		指一系列允许设备达成某个目标的动作（通常链路层控制流程或数据交换）。一个流程通常和一个其他端的模式关联，因此他们通常一同紧密结合。

*安全性（Security）*

​		GAP在安全管理和安全管理协议的之上，通过定义安全模式、制定端设备如何根据特定的数据交换需求设置安全等级以及之后安全等级如何被强制的这个流程，进行搭建。GAP更进一步定义了额外的与特定的模式或流程毫无联系的安全特征，而且可以自有使用这些以增加数据保护的等级来应对每一个应用的需求。

*附带GAP数据格式*

​		除了以上的几条，GAP也被用来为某些与GAP规格书定义的流程和模式相关的附带信息格式的定义，作为预留。

本章相关部分讲详细调查这些要素。



## 角色

GAP指定了设备采纳并加入一个BLE网络的四种角色：

*广播者（Broadcaster）*

​		为仅负责传输的应用优化数据规律地分发，广播者这个角色定期地发送广播数据包。理论上说，广播者可以被仅带发送器的无线传输模块使用，但实际上，这角色通常被指派给同时拥有发送和接受功能的设备上。读取任意相关设备温度并进行广播的公共温度计就是一个很好的广播者的例子。广播者发送广播包而不是连接数据包，并且数据可以被任何正在倾听（listen）的设备访问。广播者（broadcaster）角色使用链路层广播者（advertiser）的角色。

*观察者（Observer）*

​		为仅接收、尝试从广播设备手机数据的应用优化，观察者倾听那些来自广播端的广播包内的数据。带有显示器的设备通常是这个角色的典型应用，比如显示从只广播数据的温度传感器得到的温度数据的平板电脑。观察者（observer）角色使用链路层扫描者（scanner）的角色。

*中心设备（Central）*