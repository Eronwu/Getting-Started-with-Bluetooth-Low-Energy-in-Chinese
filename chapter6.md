# 第六章，调试工具

本章介绍了用于BLE的一些有用的调试和开发工具。这包含了硬件工具，如无线协议分析工具（wireless protocol analyzers）或者*嗅探器*（sniffers，嗅探空中的传输数据，将获取到的数据现实在一个UI上并之后进行分析），还有在调试期间与BLE从设备直接交互的工具。

## PCA10000 USB Dongle 和 Master Control Panel

PCA10000是一个USB电子狗，是诺迪克半导体的nRF51822-EK套件的一部分（参见第五章[用nRF51822-EK工作](./chapter5.md#用nRF51822-EK工作)），这个是nRF51822片上系统（SoC）的一个低成本评估套件。当这个套件被正在设计自有的BLE从设备的嵌入式硬件工程师设计时，即使你只开发手机应用，购买该套件也会比较划算，因为套件包含了许多非常有用和价格合理的调试工具。

Master Control Panel (MCP)是其中的一个调试工具，这是一个Windows界面的程序，可以将PCA10000 USB Dongle模拟成为一个BLE中心设备。该工具的有一个易操作的界面，你可以看到范围内任何BLE从设备的数据，或者给任何你已连接的从设备发送数据。这在没有包含BLE本地支持的Windows 7上也非常适用（Windows 8上支持BLE，但操作系统没有包含一个用于测试和调试的类似应用）。

![figure-bird](D:\work\myCash\book\Getting Started with Bluetooth Low Energy in Chinese\pic\figure-bird.png)诺迪克也给Android提供了一个主控平台（Master Control Panel）应用，包含了一些相同的功能却不需要任何硬件的需求，虽然截止目前，适用PCA10000的独立工具支持大量工具集。

如果你在编写一个现有从设备的应用程序，你也可以使用MCP去逆向还原BLE设备，显示设备自有数据结构和配置设置信息，然后在你的手机应用中使用发现服务和特征UUID来访问它们。

MCP使用一个制定的包含了工具安装包的固件镜像来和PCA10000交流。使用诺迪克的nRFGo Studio（在诺迪克的网站注册你的nRF51822-EK套件后即可看到使用，第五章[例子和工具链](./chapter5.md#例子和工具链)有相关信息），你可以更新USB dongle来使用该固件镜像。

一旦PCA10000已经升级成合适的固件，你可以打开MCP与从设备通过一个简单的UI交互进行交流，这可以几乎完成一个普通中心设备的任何功能。其包含了绑定、打开或者关闭一个连接，读写GATT特征等。

图6-1展示了一个单独的从设备广播自己的结果。

一旦你连接从设备，并发送一个服务发现请求，你就会看到设备上一组服务和特征（见图6-2），同样你也可以用这样的方式读取任意常规BLE中心设备。

你可以通过选择一个合适的特征进行更新值，在文本编辑框馁修改数值，并点击“发送更新”。你也可以通过选择特征并点击读取键来获取最新的特征值，对于特征的通知和指示都未使能的情况下，这是非常有用的。

![图6-1](.\pic\figure6-1.png)

*图6-1. 主控制面板（MCP）显示广播数据*

在早期硬件开发过程中，MCP是一个极其脆弱的工具，当你可能没有一个手机应用给你BLE从设备进行交流的时候。主控制面板可以模拟几乎任何你的应用执行的动作，包括校验通信中进出的数据。

MCP也包括了一组C#库，被用于自动提供其任意的功能，允许应用开发者创建一个拥有简单但完整的一组中心设备的API的桌面应用或者命令行应用。这对于这对于自动化复原测试或者产品测试可以说是非常有用的。

![figure6-2](.\pic\figure6-2.png)

*图6-2. 主控制面板展示服务和特征数据*

## PCA10000 USB Dongle 和 Wireshark

前文的主控制面板（Master Control Panel）似乎是与BLE从设备交互最简单的方式，但是一些用例需求访问BLE的底层数据。对于这些情况，诺迪克也提供给给PCA10000或者PCA10001一个通用的固件镜像和工具（这两个都包含在nRF51822-EK开发套件内），可以从一个单独的从设备嗅探通信数据并推送到[Wireshark](http://www.wireshark.org/)内。

Wireshark是一个成熟而功能强大的开源数据获取和分析的软件，该软件可以将包和字节级别的数据轻松可视化。诺迪克的Wireshark插件（见图6-3，可在[诺迪克官网](http://www.nordicsemi.com/)注册nRF51822-EK套件后使用）通过nRF51822-EK开发板获取数据，并增加有用的描述帮助理解这些原始的数据。

![figure6-3](.\pic\figure6-3.png)

*图6-3. 诺迪克半导体的PCA10000在Wireshark插件的数据*

如果你仅对设计与已有的BLE从设备通信的应用感兴趣，你将几乎不需要到达底下这一层。但是对于从事从设备设计、编码或者尝试调试一个制定的时延、吞吐量的硬件设计师或者固件工程师来说，这个就非常的实用。

## CC2540 USB Dongle 和 SmartRF Sniffer