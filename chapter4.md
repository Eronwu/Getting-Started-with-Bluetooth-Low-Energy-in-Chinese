# 第四章，GATT（Services and Characteristics）

通用属性配置文件（The Generic Attribuite Profile, GATT）建立在如何通过一个蓝牙连接交换所有的配置文件以及用户数据。与定义了设备间底层交互的[GAP](./chapter3.md)对比，GATT仅处理实际数据传输流程和格式。

GATT也为GATT为基础的配置文件（在第一章的[SIG组织定义的GATT基础配置文件](./chapter1.md#SIG组织定义的GATT基础配置文件)）提供了参照框架，这覆盖了明确的用例和确保来自不同厂商的设备的交互操作性。所有标准BLE配置文件都是基于GATT，并必须基于其进行准确地操作。这使得GATT作为BLE规格书中一个关键的章节，因为每一个关于应用和用户的数据项都必须格式化、打包化、以及根据自身的规则发送。

GATT使用属性协议（详尽参阅第二章[属性协议(ATT)](./chapter2.md#属性协议)）作为自身传输协议来交换设备间的数据。这数据被有层级地按区块组织，并成为*服务（services）*，概念上与用户数据相关联的组称为*特征（characteristics）*。这决定了本章中许多GATT的基础形态。

## 角色

正如蓝牙规格书中任意其他协议或者配置文件，GATT由定义相互交互的设备的角色开始：

*客户端（Client）*

​		GATT客户端与第二章[属性协议(ATT)](./chapter2.md#属性协议)中讨论的ATT客户端相对应。GATT客户端发送请求给服务器并接收其响应包（已启动服务的更新）。GATT客户端起初不知道任何关于服务器的属性，因此必须执行服务发现流程来询问关于这些属性的存在和性质。在完成服务发现流程之后，GATT客户端就可以开始读取已发现的服务中的属性，包括收取已启动服务的更新。

*服务端（server）*

​		GATT服务端与第二章[属性协议(ATT)](./chapter2.md#属性协议)中讨论的ATT服务端相对应。GATT服务端能接受来自客户端的请求并发送应答响应包。在做一些配置情况下，GATT服务端也会发送已启动服务的更新，并且需要作为一个角色负责存储和使客户端能使用用户数据，在属性内组织。每一个已出售的BLE设备都必须包含一个基本的可以响应客户端请求的GATT服务端，甚至仅返回一个错误响应。

值得再次一提的是GATT角色完全不依赖于GAP角色（参见第三章[角色](./chapter3.md#角色)），两者间也同时兼容。这意味着一个GAP中心设备和一个GAP外围设备可以都作为GATT客户端或者服务端，甚至或者同时作为两者存在。

## UUIDs

通用唯一标识符（universally unique identifier, UUID）是一个128位（16字节）确保为（或者很大可能上）全球唯一的数字。除了蓝牙，UUID被用于许多协议和应用，其格式、用法、和产生都在[ITU-T Rec. X.667](bit.ly/1gScfna)被指定，或者是著名的[ISO/IEC 9834-8:2005](bit.ly/1es3R3t)。

为了效率，也因为16字节会占据链路层27字节数据负载的很大一部分，BLE规格书增加了两个额外的UUID格式：16位和32位UUID。这个大大缩短的格式仅用于蓝牙规格书中定义的UUID（也就是，这个是由蓝牙SIG罗列作为标准蓝牙UUID）。

从缩短的UUID版本重建位完整的128位UUID，需要插入蓝牙基本UUID内16或者32位值（由xxxxxxxx表示，包括其实的0）：

​	xxxxxxxx-0000-1000-8000-00805F9B34FB

SIG提供给所有的类型、服务和其定义指定的配置文件一些UUID。但是如果应用需要自己的UUID，不是因为SIG提供的没有满足其需求就是因为想要实现一个之前未在配置配置文件规格书中考虑到的新的用力，可以依照[ITU’s UUID generation page](https://www.itu.int/en/ITU-T/asn1/Pages/UUID/uuids.aspx)生成。

对于不是源自蓝牙基本的UUID（通常称为*厂商指定 vendor-specific* 的UUID），这种缩短的格式是不可以使用的。在这种情况下，你需要从始至终使用完整的128位的UUID。

